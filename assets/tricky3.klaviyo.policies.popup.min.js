!function(e){var o=function(o,i){var a={CookieName:"KlaviyoPopup",SessionCookieName:"KlaviyoPopupSession",PolicyCookieName:"ts_cookie_policy",Visits:[],Delay:1e4,PageViewNumber:1,CloseSelectors:[],ShowSelectors:[],ShowPopupOnCurrentPage:!1,InnerWrapper:".modal",SignupKey:"signup",HidePopupOnSuccess:!0,HidePopupOnSuccessTimeout:5e3,ShowAlertMessage:!0,AjaxSubmitAttr:"data-ajax-submit",BValidatorOptions:{singleError:!0},CallBacks:{OnSuccess:function(e,o){},OnError:function(e){void 0===e&&(e=null)},OnDisplayed:function(){},OnClosed:function(e){void 0===e&&(e=null)},OnFormSubmitted:function(){},BeforeSubmit:function(){}},MessageWrapperSelectors:{Success:".klaviyo_messages .success_message",Error:".klaviyo_messages .error_message"},Messages:{Success:"Thank you!"},IsBlocking:!1,ForceShow:!1,HideCookiePolicyMessageIfNeeded:!1};e.extend(a,i||{});var s={VisitsCookieTracker:{Status:"",PageView:0,Visits:0,PopupAlreadyShownOnVisit:[]},CookiesValues:{NotSubmitted:"NotSubmitted",HasSubmitted:"HasSubmitted",ShowOnNextVisit:"ShowOnNextVisit",ErrorInSubmitted:"ErrorInSubmitted"},MainWrapper:o,KForm:e("form",this.MainWrapper)},n={Load:function(){n.SetupPolicyCookie(),n.FirstTimeLoaded=!n.PolicyCookieAccepted,T3Core.Debug("KPP: first time loaded "+n.FirstTimeLoaded+"."),n.PolicyCookieAccepted?(T3Core.Debug("KPP: cookie policy accepted."),a.HideCookiePolicyMessageIfNeeded&&n.HideCookiePolicyMessageIfNeeded(),n.Initialize()):n.Show();var e=T3Core.GetQueryStringByKey(a.SignupKey);""!==e&&1==e?(T3Core.Debug("KPP: sign up key found, forcing show."),n.Show()):a.ForceShow&&n.Show(),n.InitCustomEvents()},HideCookiePolicyMessageIfNeeded:function(){T3Core.Debug("KPP: hiding cookie policy message."),e(".cookie-policy").css("display","none")},GetPolicyCookie:function(){return T3Core.CookieManager.ReadCookie(a.PolicyCookieName)},SetupPolicyCookie:function(){n.AddPolicyCookieIfUserHasAlreadySignedUp(),n.GetPolicyCookie()&&(n.PolicyCookieAccepted=!0)},AddPolicyCookie:function(){n.GetPolicyCookie()?T3Core.Debug("KPP: cookie policy already exist."):(T3Core.Debug("KPP: added cookie policy."),T3Core.CookieManager.CreateCookie(a.PolicyCookieName,1,30))},AddPolicyCookieIfUserHasAlreadySignedUp:function(){var e=T3Core.CookieManager.ReadCookie(a.CookieName);if(null!==e)try{var o=JSON.parse(e);o.Status&&o.Status===s.CookiesValues.HasSubmitted&&!n.GetPolicyCookie()&&(T3Core.Debug("KPP: user has subscribed on klaviyo popup before. Adding cookie policy."),n.AddPolicyCookie())}catch(i){}},Initialize:function(){n.Initialized?T3Core.Debug("KPP: is already initialized."):(T3Core.Debug("KPP: initializing."),n.InitDefaultKlaviyoCookies(),n.Initialized=!0,a.IsBlocking?this.SetupModalPopup():this.ReadAndSetupCookieValues())},InitDefaultKlaviyoCookies:function(){var e="klaPages",o=parseInt(T3Core.CookieManager.ReadCookie(e),10);o=isNaN(o)?1:o+1,T3Core.CookieManager.CreateCookie(e,o,365)},InitializeAndAddPolicyCookie:function(){n.AddPolicyCookie(),n.Initialize()},InitCustomEvents:function(){for(var o=0;o<a.CloseSelectors.length;o++){var i=e(a.CloseSelectors[o]);i.click(function(e){e.preventDefault(),T3Core.Debug("KPP: close button clicked."),n.InitializeAndAddPolicyCookie(),n.Hide(!0)})}for(var o=0;o<a.ShowSelectors.length;o++){var t=e(a.ShowSelectors[o]);t.click(function(e){e.preventDefault(),T3Core.Debug("KPP: show button clicked."),n.InitializeAndAddPolicyCookie(),n.Show(!0)})}a.IsBlocking||(e(document).on("keydown",function(e){var o=null==e?e.keyCode:e.which;27==o&&(T3Core.Debug("KPP: escape key pressed."),n.InitializeAndAddPolicyCookie(),n.Hide(!0))}),s.MainWrapper.click(function(){T3Core.Debug("KPP: wrapper clicked."),n.InitializeAndAddPolicyCookie(),e(this).hasClass("modalize")&&n.Hide(!0)})),e(a.InnerWrapper,s.MainWrapper).on("click",function(o){var i=e(o.target),a=i.is("input")||i.is("button"),s=i.is("a");s&&i.hasClass("privacy-learn")?(o.stopPropagation(),T3Core.Debug("KPP: privacy learn clicked, no cookies will be added.")):a?(o.stopPropagation(),T3Core.Debug("KPP: form element clicked, propagation stopped."),n.InitializeAndAddPolicyCookie()):T3Core.Debug("KPP: propagating click event to main wrapper.")})},SetupModalPopup:function(){var e=this.ReadJsonFromCookie(a.CookieName);T3Core.Debug("KPP: setupModalPopup fired "+e),null===e?this.Show():this.Hide()},ReadAndSetupCookieValues:function(){var e=T3Core.CookieManager.ReadCookie(a.SessionCookieName),o=this.ReadJsonFromCookie(a.CookieName);if(null==o&&null==e)T3Core.CookieManager.CreateCookie(a.SessionCookieName,1),this.SaveJsonToCookie(a.CookieName,s.CookiesValues.ShowOnNextVisit,1,1,"",30),o=this.ReadJsonFromCookie(a.CookieName);else if(null==o&&(this.SaveJsonToCookie(a.CookieName,s.CookiesValues.ShowOnNextVisit,1,1,"",30),o=this.ReadJsonFromCookie(a.CookieName)),null==e){var i=o,t=i.Visits+1,r=i.PageView;T3Core.CookieManager.CreateCookie(a.SessionCookieName,t),i.Status==s.CookiesValues.ShowOnNextVisit&&this.SaveJsonToCookie(a.CookieName,s.CookiesValues.ShowOnNextVisit,r,t,"",30)}o.Status==s.CookiesValues.ShowOnNextVisit&&a.ShowPopupOnCurrentPage&&n.ProcessCookiesValuesAndShowPopupIfNeeded()},ReadJsonFromCookie:function(e){var o=T3Core.CookieManager.ReadCookie(e),i=null;if(null!=o)try{i=JSON.parse(o)}catch(a){o.indexOf(s.CookiesValues.HasSubmitted)!==-1&&(n.SaveJsonToCookie(e,s.CookiesValues.HasSubmitted,"","","",365),i=JSON.parse(T3Core.CookieManager.ReadCookie(e)))}return i},ProcessCookiesValuesAndShowPopupIfNeeded:function(){var o=this.ReadJsonFromCookie(a.CookieName),i={PageView:0,Visits:0,NeedToShowPopupOnCurrentVisit:!1,NeedToShowPopupOnCurrentPageView:!1,PopupAlreadyShown:!1,ShowPopup:!1};if(i.PageView=parseInt(o.PageView),i.Visits=parseInt(o.Visits),o.PopupAlreadyShownOnVisit.length>0&&(i.PopupAlreadyShown=e.inArray(i.Visits,o.PopupAlreadyShownOnVisit)!=-1),i.NeedToShowPopupOnCurrentVisit=e.inArray(i.Visits,a.Visits)!=-1&&!i.PopupAlreadyShown,i.NeedToShowPopupOnCurrentPageView=i.PageView==a.PageViewNumber,i.NeedToShowPopupOnCurrentVisit&&i.PageView<=a.PageViewNumber)if(i.NeedToShowPopupOnCurrentPageView)this.SaveJsonToCookie(a.CookieName,s.CookiesValues.ShowOnNextVisit,1,i.Visits,i.Visits,30);else{var t=i.PageView+1;this.SaveJsonToCookie(a.CookieName,s.CookiesValues.ShowOnNextVisit,t,i.Visits,"",30)}i.Visits>a.Visits[a.Visits.length-1],i.ShowPopup=i.NeedToShowPopupOnCurrentVisit&&i.NeedToShowPopupOnCurrentPageView,T3Core.Debug("KPP: processCookiesValuesAndShowPopupIfNeeded, show popup: "+i.ShowPopup+", first time loaded: "+n.FirstTimeLoaded),i.ShowPopup&&!n.FirstTimeLoaded&&this.Show(!1)},Show:function(e){if(void 0===e&&(e=null),n.IsShown)T3Core.Debug("KPP: show fired: already visible.");else{T3Core.Debug("KPP: show fired."),n.IsShown=!0;var o=e?1e3:a.Delay;setTimeout(function(){s.MainWrapper.addClass("modalize"),n.CallBackHandler.OnDisplayed(),n.SubmitBinded||(n.SubmitBinded=!0,n.InitBValidator(),n.InitAjaxSubmit())},o)}},Hide:function(e){n.IsShown?(T3Core.Debug("KPP: hide fired."),s.MainWrapper.removeClass("modalize"),n.CallBackHandler.OnClosed(e),n.IsShown=!1):T3Core.Debug("KPP: hide fired: already hidden.")},InitBValidator:function(){s.KForm.bValidator(a.BValidatorOptions)},InitAjaxSubmit:function(){s.KForm.submit(function(o){var i=e(this);if(i.data("bValidator").isValid()){o.preventDefault(),n.CallBackHandler.BeforeSubmit();var s=i.attr(a.AjaxSubmitAttr),t=(new Date).getTimezoneOffset()/-60;e(".timeOffset",i).length?e(".timeOffset",i).val(t):i.append('<input type="hidden" value="'+t+'" class="timeOffset klaviyo-field" name="$timezone_offset"/>');var r=[],l=e(".klaviyo-field",i);l.each(function(){r.push(e(this).attr("name")+"="+encodeURIComponent(e(this).val().replace(/%3A/g,":")))});var u=r.join("&"),d=e(this).find(".klaviyo-custom-property").map(function(){return e(this).attr("name")}).get();d.length&&(u+="&$fields="+d.join(",")),e.post(s,u,n.AjaxFormSubmitCallBack),n.CallBackHandler.OnFormSubmitted()}})},AjaxFormSubmitCallBack:function(o){if(o.success){n.UserHasSignedUp=!0,n.SaveJsonToCookie(a.CookieName,s.CookiesValues.HasSubmitted,"","","",365);var i=e(a.MessageWrapperSelectors.Success,s.MainWrapper);i.append(a.Messages.Success).css("display","block"),n.CallBackHandler.OnSuccess(o),a.HidePopupOnSuccess&&setTimeout(function(){n.Hide(!1)},a.HidePopupOnSuccessTimeout)}else{var t=e(a.MessageWrapperSelectors.Error,s.MainWrapper);e(o.errors).each(function(){t.append("<p>"+this+"</p>")}),t.css("display","block"),n.CallBackHandler.OnError(o)}},SaveJsonToCookie:function(e,o,i,a,n,t){s.VisitsCookieTracker.Status=o,s.VisitsCookieTracker.PageView=i,s.VisitsCookieTracker.Visits=a,""!=n&&s.VisitsCookieTracker.PopupAlreadyShownOnVisit.push(n),T3Core.CookieManager.CreateCookie(e,JSON.stringify(s.VisitsCookieTracker),t)},UserHasSignedUp:!1,IsShown:!1,PolicyCookieAccepted:!1,Initialized:!1,FirstTimeLoaded:!1,SubmitBinded:!1};return n.CallBackHandler={OnClosed:function(e){a.CallBacks.OnClosed&&a.CallBacks.OnClosed(e&&!n.UserHasSignedUp)},OnFormSubmitted:function(){a.CallBacks.OnFormSubmitted&&a.CallBacks.OnFormSubmitted()},OnDisplayed:function(){a.CallBacks.OnDisplayed&&a.CallBacks.OnDisplayed()},OnError:function(e){a.CallBacks.OnError&&a.CallBacks.OnError(e)},OnSuccess:function(o){if(window._learnq){var i=e('input[name="email"]',s.MainWrapper).val(),n=e('input[name="$source"]',s.MainWrapper).length?e('input[name="$source"]',s.MainWrapper).val():"";window._learnq.push(["identify",{$email:i,$source:n}]),window._learnq.push(["trackActivity"])}a.CallBacks.OnSuccess&&a.CallBacks.OnSuccess(o,s.MainWrapper)},BeforeSubmit:function(){a.CallBacks.BeforeSubmit&&a.CallBacks.BeforeSubmit()}},function(){n.Load()}(),{show:n.Show,hide:n.Hide,cookiePolicyAccepted:n.PolicyCookieAccepted}};e.fn.KlaviyoPolicyPopup=function(e){return o(this,e)}}(jQuery);